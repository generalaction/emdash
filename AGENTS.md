---
default_branch: main
package_manager: pnpm
node_version: "22.20.0"
start_command: "pnpm run d"
dev_command: "pnpm run dev"
build_command: "pnpm run build"
test_commands:
  - "pnpm run lint"
  - "pnpm run type-check"
  - "pnpm exec vitest run"
ports:
  dev: 3000
required_env: []
optional_env:
  - TELEMETRY_ENABLED
  - EMDASH_DB_FILE
  - EMDASH_DISABLE_NATIVE_DB
  - CODEX_SANDBOX_MODE
  - CODEX_APPROVAL_POLICY
---

**Quickstart**
1. `nvm use` (installs Node 22.20.0 if missing) or install Node 22.x manually.
2. `pnpm run d` to install dependencies, rebuild native modules, and launch Electron + Vite.
3. If `pnpm run d` fails mid-stream, rerun `pnpm install`, then `pnpm run dev` (main + renderer).

**Testing**
1. Run `pnpm run lint`.
2. Run `pnpm run type-check`.
3. Run `pnpm exec vitest run` (tests live under `src/**/*.test.ts`).

**Build & Package**
1. `pnpm run build` to compile the Electron main and Vite renderer.
2. Platform-specific installers: `pnpm run package:mac|linux|win` (artifacts in `release/`).
3. If native modules misbehave, `pnpm run rebuild`; use `pnpm run reset` as a last resort.

**Repo Map**
- `src/main/` – Electron main process, IPC, database access, CLI orchestration.
- `src/renderer/` – React UI, providers, terminal panes, integrations.
- `src/shared/` & `src/types/` – Shared utilities and type definitions.
- `drizzle/` – SQLite migrations generated by Drizzle ORM (`drizzle.config.ts` controls paths).
- `build/` – Electron Builder assets (entitlements, icons); avoid casual edits.

**Guardrails**
- Do work on branches or worktrees; default branch is `main`, never push directly.
- Do limit edits to `src/**`, `docs/**`, or config files you fully understand; keep binaries, `dist/`, and `release/` untouched.
- Do keep secrets local; configure providers via their CLIs, not committed files.
- Don't rewrite Drizzle migration history (`drizzle/meta`, numbered SQL) without coordinating.
- Don't modify telemetry defaults or updater logic unless the change is intentional and reviewed.
- Don't run commands that mutate global environments (package installs, git pushes) from agent scripts.

**Risky Areas**
- `src/main/services/CodexService.ts` – manages long-lived child processes and log streaming; race conditions or unhandled exits can kill agent runs.
- `src/main/db/**` + `drizzle/` – schema migrations and SQLite access; mismatches can corrupt user data.
- `build/` entitlements and updater config – incorrect changes break signing/auto-update.
- Native dependencies (`sqlite3`, `node-pty`, `keytar`) – rebuilding is slow; avoid upgrading casually.

**Pre-PR Checklist**
- [ ] Dev server runs: `pnpm run d` (or `pnpm run dev`) starts cleanly.
- [ ] Tests and checks pass: `pnpm run lint`, `pnpm run type-check`, `pnpm exec vitest run`.
- [ ] No stray build artifacts or secrets committed.
- [ ] Documented any schema or config changes impacting users.
