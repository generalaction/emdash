---
default_branch: main
package_manager: npm
node_version: "22.20.0"
start_command: "npm run d"
dev_command: "npm run dev"
build_command: "npm run build"
test_commands:
  - "npm run lint"
  - "npm run type-check"
  - "npx vitest run"
ports:
  dev: 5173
required_env: []
optional_env:
  - TELEMETRY_ENABLED
  - EMDASH_DB_FILE
  - EMDASH_DISABLE_NATIVE_DB
  - CODEX_SANDBOX_MODE
  - CODEX_APPROVAL_POLICY
---

**Quickstart**
1. `nvm use` (installs Node 22.20.0 if missing) or install Node 22.x manually.
2. `npm run d` to install dependencies, rebuild native modules, and launch Electron + Vite.
3. If `npm run d` fails mid-stream, rerun `npm install`, then `npm run dev` (main + renderer).

**Testing**
1. Run `npm run lint`.
2. Run `npm run type-check`.
3. Run `npx vitest run` (tests live under `src/**/*.test.ts`).

**Build & Package**
1. `npm run build` to compile the Electron main and Vite renderer.
2. Platform-specific installers: `npm run package:mac|linux|win` (artifacts in `release/`).
3. If native modules misbehave, `npm run rebuild`; use `npm run reset` as a last resort.

**Repo Map**
- `src/main/` – Electron main process, IPC, database access, CLI orchestration.
- `src/renderer/` – React UI, providers, terminal panes, integrations.
- `src/shared/` & `src/types/` – Shared utilities and type definitions.
- `drizzle/` – SQLite migrations generated by Drizzle ORM (`drizzle.config.ts` controls paths).
- `build/` – Electron Builder assets (entitlements, icons); avoid casual edits.

**Guardrails**
- Do work on branches or worktrees; default branch is `main`, never push directly.
- Do push only to `origin` (cschubiner/emdash); never push to `upstream` (generalaction/emdash).
- Do limit edits to `src/**`, `docs/**`, or config files you fully understand; keep binaries, `dist/`, and `release/` untouched.
- Do keep secrets local; configure providers via their CLIs, not committed files.
- Don't rewrite Drizzle migration history (`drizzle/meta`, numbered SQL) without coordinating.
- Don't modify telemetry defaults or updater logic unless the change is intentional and reviewed.
- Don't run commands that mutate global environments (package installs, git pushes) from agent scripts.

**Risky Areas**
- `src/main/services/CodexService.ts` – manages long-lived child processes and log streaming; race conditions or unhandled exits can kill agent runs.
- `src/main/db/**` + `drizzle/` – schema migrations and SQLite access; mismatches can corrupt user data.
- `build/` entitlements and updater config – incorrect changes break signing/auto-update.
- Native dependencies (`sqlite3`, `node-pty`, `keytar`) – rebuilding is slow; avoid upgrading casually.

**Repo Remotes & Main Branch Policy**
- `origin` = `https://github.com/cschubiner/emdash.git` (fetch/push; default push remote).
- `upstream` = `https://github.com/generalaction/emdash.git` (fetch-only; push URL disabled).
- Keep local tag `main` deleted to avoid ref ambiguity; if it reappears, push main via `git push origin refs/heads/main`.
- Pull upstream changes via `git fetch upstream` then `git rebase upstream/main` (or merge), and push the result to `origin`.
- PRs and compare URLs must target `cschubiner/emdash` only; never open PRs against `generalaction/emdash`.
- Dotfiles `bo()` (branch-open) prefers `cschubiner/*` push remotes when building compare URLs.
- `remote.pushDefault` is set to `origin` for this repo.

**Pre-PR Checklist**
- [ ] Dev server runs: `npm run d` (or `npm run dev`) starts cleanly.
- [ ] Tests and checks pass: `npm run lint`, `npm run type-check`, `npx vitest run`.
- [ ] No stray build artifacts or secrets committed.
- [ ] Documented any schema or config changes impacting users.
