---
title: Project Configuration
description: Customize Emdash behavior per project
---

Emdash can be configured on a per-project basis using a `.emdash.json` file in your project root. This lets you tailor how worktrees are set up and which files get copied to them.

## Copying files to worktrees

When you create a new task, Emdash sets up a Git worktree so the agent can work in isolation. By default, worktrees start fresh from your repository, which means gitignored files like `.env` won't be there.

To solve this, Emdash automatically copies certain gitignored files from your main project into each new worktree. This happens once when the worktree is created, and only for files that don't already exist in the destination.

The default patterns cover common environment files:

```
.env
.env.keys
.env.local
.env.*.local
.envrc
docker-compose.override.yml
```

These defaults work well for most projects, but you can customize them if needed.

## Custom preserve patterns

To specify your own list of files to copy, create a `.emdash.json` file in your project root:

```json
{
  "preservePatterns": [".env", ".env.local", "config/local.yml", "secrets/*.json"]
}
```

When you define `preservePatterns`, it replaces the defaults entirely. Include any default patterns you still want alongside your custom ones.

Patterns support basic glob syntax, so `secrets/*.json` will match all JSON files in the secrets directory. Files inside `node_modules`, `.git`, `vendor`, and other common build directories are automatically excluded regardless of your patterns.

## How it works

Emdash looks for gitignored files in your main project that match your preserve patterns. For each match, it copies the file to the same relative path in the new worktree. If a file already exists in the worktree, it's left untouched, so your worktree-specific changes won't be overwritten.

This means you can safely modify environment files in a worktree without worrying about them being reset when you create new tasks.

## Lifecycle scripts

You can define scripts for three lifecycle phases in `.emdash.json`:

- `setup`: one-time initialization for a task/worktree (for example dependency install)
- `run`: long-lived process you start/stop from the task terminal header Play/Stop control
- `teardown`: cleanup when a task is archived or deleted

```json
{
  "scripts": {
    "setup": "npm i",
    "run": "npm run dev",
    "teardown": "echo teardown-ok"
  }
}
```

### Lifecycle behavior

- `setup` runs once when the task terminal is first initialized for that task/worktree.
- `run` starts when you click Play in the terminal header.
- `run` stops when you click Stop in the terminal header.
- `teardown` runs before archive/delete (best effort; archive/delete continues if teardown fails or times out).

### Important

- Scripts are read from the project root config: `<project-root>/.emdash.json`.
- If a phase script is missing, that phase is skipped.
- Lifecycle logs/events are emitted from the main process; they are not typed into the terminal input.

## Task env vars

When lifecycle scripts run, Emdash provides convenience environment variables.

| Variable                | Purpose                          |
| ----------------------- | -------------------------------- |
| `EMDASH_TASK_ID`        | Stable unique task id            |
| `EMDASH_TASK_NAME`      | Shell-safe task name slug        |
| `EMDASH_TASK_PATH`      | Absolute task (worktree) path    |
| `EMDASH_ROOT_PATH`      | Absolute project root path       |
| `EMDASH_DEFAULT_BRANCH` | Default branch name (e.g., main) |
| `EMDASH_PORT`           | Base port for a 10-port range    |

### Example: Port-aware run script

```json
{
  "scripts": {
    "setup": "npm i",
    "run": "export PORT=$EMDASH_PORT && export DB_PORT=$((EMDASH_PORT + 1)) && export COMPOSE_PROJECT_NAME=$EMDASH_TASK_NAME && npm run dev",
    "teardown": "docker compose down --remove-orphans || true"
  }
}
```

### Example: docker-compose override with task ports

```yaml
services:
  db:
    ports:
      - '${EMDASH_PORT:-5432}:5432'
  app:
    environment:
      - DATABASE_PORT=${EMDASH_PORT:-5432}
```

### Example: Port offsets (app + db + redis)

```
APP_PORT=$EMDASH_PORT
DB_PORT=$((EMDASH_PORT + 1))
REDIS_PORT=$((EMDASH_PORT + 2))
```

### Example: npm app (recommended split)

```json
{
  "scripts": {
    "setup": "npm i",
    "run": "npm run dev",
    "teardown": "echo teardown-ok"
  }
}
```

### Example: Docker compose app

```json
{
  "scripts": {
    "setup": "docker compose up -d db redis",
    "run": "docker compose up app",
    "teardown": "docker compose down --remove-orphans"
  }
}
```

### Example: Python project

```json
{
  "scripts": {
    "setup": "python -m venv .venv && . .venv/bin/activate && pip install -r requirements.txt",
    "run": ". .venv/bin/activate && uvicorn app:app --reload",
    "teardown": "echo teardown-ok"
  }
}
```

## Editing the config

You can edit your project's `.emdash.json` directly from the app. On the project page, click "Edit config" to open the configuration file in the built-in editor.

![Edit config button on the project page](/media/edit-config.png)
